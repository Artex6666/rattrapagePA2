<div class="container py-4">
  <h2 class="mb-3">Mes commandes</h2>
  <div class="row g-3">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Commandes en cours</h5>
          <div id="ordersCurrent"></div>
        </div>
      </div>
    </div>
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Historique</h5>
          <div id="ordersHistory"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
(function(){
  async function load(){
    const res = await fetch('https://api.axia.quest/api/orders/me', { credentials:'include' });
    const rows = await res.json();
    const curr = rows.filter(o => o.status === 'pending' || o.status === 'ready');
    const hist = rows.filter(o => o.status === 'completed');
    const render = (list)=> list.length ? `<div class="list-group">
      ${list.map(o=>{
        const items = (()=>{ try { return JSON.parse(o.items_json||'[]'); } catch(e){ return []; }})();
        return `<div class="list-group-item">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold">Commande #${o.id} - ${(o.total_cents/100).toFixed(2)}€</div>
              <div class="text-muted small">${new Date(o.created_at).toLocaleString('fr-FR')} • ${o.status}</div>
            </div>
            <span class="badge ${o.status==='ready'?'bg-success':'bg-secondary'}">${o.status}</span>
          </div>
          <div class="mt-2 small text-muted border-start ps-2">
            ${items.map(it=>`${it.qty} × ${it.name}`).join(' • ') || '-'}
          </div>
        </div>`;
      }).join('')}
    </div>` : '<div class="text-muted">Aucune commande.</div>';
    document.getElementById('ordersCurrent').innerHTML = render(curr);
    document.getElementById('ordersHistory').innerHTML = render(hist);
  }
  document.addEventListener('DOMContentLoaded', load);
})();
</script>


