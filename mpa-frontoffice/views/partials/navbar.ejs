<nav class="navbar navbar-expand-lg navbar-dark eco-navbar shadow-sm py-2" style="margin-bottom:0;">
  <div class="container-fluid px-3">
    <a class="navbar-brand d-flex align-items-center gap-2" href="/">
      <img src="/images/navbar_logo.png" alt="Driv'n Cook" style="height:42px; width:auto; border-radius:0.5rem; box-shadow:0 2px 8px rgba(194, 255, 177, 0.08); background:#ffffff09; padding:2px;">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto text-center" id="navbarLinks">
        <!-- Liens dynamiques JS -->
      </ul>
    </div>
  </div>
</nav>
<!-- Modal de connexion caché par défaut -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-modal="true" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4 animate-fadein">
      <div class="modal-header border-0">
        <h2 class="modal-title w-100 text-center text-white" id="loginModalLabel">Connexion</h2>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Mot de passe</label>
            <input type="password" class="form-control" id="password" name="password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Se connecter</button>
        </form>
        <div class="mt-3 text-center">
          <a href="/register" class="text-white-50">Pas encore de compte ? S'inscrire</a>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
function updateNavbar() {
  const links = document.getElementById('navbarLinks');
  links.innerHTML = '';
  links.innerHTML += '<li class="nav-item"><a class="nav-link" href="/menu">Menu</a></li>';
  links.innerHTML += '<li class="nav-item"><a class="nav-link" href="/carte">Carte</a></li>';
  links.innerHTML += `
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" id="langDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <span id="langLabel">🇫🇷</span>
      </a>
      <ul class="dropdown-menu" aria-labelledby="langDropdown">
        <li><a class="dropdown-item" href="#" data-lang="fr">🇫🇷 Français</a></li>
        <li><a class="dropdown-item" href="#" data-lang="en">🇬🇧 English</a></li>
      </ul>
    </li>
  `;

  fetch('https://api.axia.quest/api/auth/me', {
    credentials: 'include'
  })
  .then(res => res.json())
  .then(data => {
    console.log('Utilisateur connecté :', data); // 🔍 AJOUTE ÇA
    if (data.user) {
      if (data.user.role === 'franchisé') {
        links.innerHTML += '<li class="nav-item"><a class="nav-link" href="/mon-camion">Mon camion</a></li>';
      }
      links.innerHTML += '<li class="nav-item"><a class="nav-link" href="/account">Mon Compte</a></li>';
      links.innerHTML += '<li class="nav-item"><a class="nav-link" href="#" id="logoutBtn">Se déconnecter</a></li>';
    } else {
      links.innerHTML += '<li class="nav-item"><a class="nav-link" href="#" id="openLoginModal">Se connecter</a></li>';
    }
    // Set current lang flag
    const lang = localStorage.getItem('lang') || 'fr';
    const label = document.getElementById('langLabel');
    if (label) label.textContent = lang === 'en' ? '🇬🇧' : '🇫🇷';
  })
  .catch(err => {
    console.error('Erreur lors de la vérification de l\'authentification:', err);
    links.innerHTML += '<li class="nav-item"><a class="nav-link" href="#" id="openLoginModal">Se connecter</a></li>';
    links.innerHTML += '<li class="nav-item"><a class="nav-link" href="/register">S\'inscrire</a></li>';
  });
}


if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', updateNavbar);
} else {
  updateNavbar();
}
document.addEventListener('click', function(e) {
  if (e.target && e.target.id === 'logoutBtn') {
    fetch('https://api.axia.quest/api/auth/logout', {
      method: 'POST',
      credentials: 'include'
    }).then(() => {
      updateNavbar();  // Met à jour la navbar après la déconnexion
      window.location.href = '/';
    });
  }
  // Lang selector (stub)
  if (e.target && e.target.matches('[data-lang]')) {
    e.preventDefault();
    const lang = e.target.getAttribute('data-lang');
    localStorage.setItem('lang', lang);
    location.reload();
  }
  if (e.target && e.target.id === 'openLoginModal') {
    const modal = new bootstrap.Modal(document.getElementById('loginModal'));
    modal.show();
    document.body.classList.add('modal-open');
  }
});

</script>
  